<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>The RAD Ledger ‚Äî Source of Truth</title>

<style>
*{box-sizing:border-box}
body{margin:0;background:#fff;color:#0f172a;font-family:Arial,system-ui,sans-serif}

/* Banner */
.banner{
  background:linear-gradient(90deg,#0A74D0,#083c80);
  color:#fff;text-align:center;
  padding:20px 10px 18px;
  font-size:1.05rem;font-weight:600;line-height:1.4;
  border-bottom:2px solid #062a5c;
  box-shadow:0 4px 10px rgba(0,0,0,.25)
}
.banner em{
  display:block;margin-top:6px;
  font-style:italic;font-weight:500;opacity:.85
}

/* Header */
header{
  text-align:center;padding:52px 10px 20px;
  background:#eaf3ff;border-bottom:2px solid #d7e7ff;
  position:relative
}
header h1{
  font-size:2.2rem;margin:0;color:#0A74D0
}
header p{
  margin:10px 0 0;color:#334155
}

/* Back Button */
.back-btn{
  position:absolute;top:10px;left:18px;
  background:#0A74D0;color:#fff;
  padding:6px 10px;border-radius:6px;
  text-decoration:none;font-weight:600;font-size:.8rem;
  transition:opacity .2s ease,transform .2s ease
}
.back-btn:hover{
  opacity:.9;transform:translateY(-1px)
}

/* Annual Notice */
.annual{
  max-width:760px;margin:20px auto 24px;padding:14px 16px;
  border-radius:10px;border:1px solid #d4e1ff;
  background:#edf3ff;color:#0f172a;
  font-size:.95rem;line-height:1.5
}
.annual ul{margin:6px 0 6px 18px;padding:0;list-style:disc}

/* Legend */
.legend{
  background:#f1f5fb;color:#0A74D0;
  text-align:center;font-size:.95rem;font-weight:600;
  padding:12px 8px;border-bottom:1px solid #d7e7ff;line-height:1.6
}
.legend span{display:block;margin:4px 0}

/* View Filters */
.view-filters{
  background:#eef2ff;border-bottom:2px solid #d7e7ff;
  padding:10px 12px;display:flex;justify-content:center;
  gap:8px;flex-wrap:wrap
}
.view-label{font-size:.9rem;font-weight:600;color:#0A74D0}
.view-pill{
  border:none;border-radius:999px;padding:4px 10px;
  font-size:.85rem;cursor:pointer;background:#e5e7eb;
  color:#111827;font-weight:600;
  transition:background .15s ease,transform .15s ease
}
.view-pill:hover{background:#d4d4d8;transform:translateY(-1px)}
.view-pill.active{background:#0A74D0;color:#f9fafb}

/* Rug / Lists */
.rug-link-container{
  text-align:center;background:#fffbe6;
  border-bottom:2px solid #d7e7ff;padding:14px 0 22px
}
.rug-link{
  display:inline-block;background:#facc15;color:#111827;
  font-weight:700;font-size:.95rem;text-decoration:none;
  padding:9px 18px;border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.25);
  border:2px solid #b45309;transition:all .2s ease
}
.rug-link:hover{
  background:#fde047;transform:translateY(-2px) scale(1.02);
  box-shadow:0 3px 8px rgba(0,0,0,.3)
}

/* Submit Button */
.submit-link{
  display:inline-block;background:#0A74D0;color:#fff;
  font-weight:600;font-size:.9rem;text-decoration:none;
  padding:8px 14px;border-radius:8px;margin:12px auto 24px;
  box-shadow:0 2px 5px rgba(0,0,0,.2);
  transition:background .2s ease,transform .2s ease
}
.submit-link:hover{background:#094d9d;transform:translateY(-2px)}

main{max-width:900px;margin:30px auto;padding:0 16px}
h2{
  color:#0A74D0;border-bottom:1px solid #cbd5e1;
  padding-bottom:4px;font-size:1.3rem;margin-bottom:14px
}
h3{color:#0A74D0;font-size:1.1rem;margin:10px 0}

ul{list-style:none;padding:0;margin:0}
li.entry{
  margin:6px 0;padding:8px 10px;
  border-bottom:1px dashed #cbd5e1;
  font-size:.95rem;display:flex;
  justify-content:space-between;align-items:center;
  cursor:pointer;border-radius:6px;
  transition:background .15s ease
}
li.entry:hover{background:#f1f7ff}
li span{color:#475569;font-size:.85rem}

footer{
  text-align:center;padding:20px;
  border-top:2px solid #d7e7ff;color:#475569;font-size:.9rem
}

/* Modal */
.modal{
  display:none;position:fixed;z-index:999;
  left:0;top:0;width:100%;height:100%;
  background:rgba(0,0,0,.55)
}
.modal-content{
  background:#fff;color:#0f172a;
  margin:8% auto;padding:20px;
  border:2px solid #d0e3ff;border-radius:10px;
  width:90%;max-width:500px;
  max-height:80vh;overflow-y:auto;
  box-shadow:0 10px 30px rgba(0,0,0,.25)
}
.close{
  float:right;font-size:1.5rem;cursor:pointer;color:#0A74D0
}
.close:hover{color:#083c80}
.modal-content a{
  color:#0A74D0;text-decoration:none;font-weight:bold
}
.checkmark{color:#0A74D0;font-weight:bold}
</style>
</head>

<body>

<div class="banner">
  üöß The Ledger‚Äôs being built. Verified projects will appear soon.<br>
  Don‚Äôt rush perfection.
  <em>‚Äî Rad</em>
</div>

<header>
  <a href="/" class="back-btn">‚Üê Back</a>
  <h1>The RAD Ledger</h1>
  <p>The meme coin with a ledger ‚Äî certifying XRPL projects.</p>
</header>

<section class="annual">
  <strong>Listings, Certification & Renewals</strong>
  <p style="margin:8px 0 4px">
    The RAD Ledger separates <strong>Certified</strong> projects from <strong>Verified</strong> projects.
  </p>
  <ul>
    <li><strong>Certified</strong> listings are permanent.</li>
    <li><strong>Verified</strong> listings must renew annually.</li>
    <li>Expired listings must be re-reviewed.</li>
  </ul>
</section>

<div class="legend">
  <span>üü° Certified ‚Äî Doxxed + Seal NFT</span>
  <span>üî∑ Verified ‚Äî Non-Doxxed</span>
  <span>‚ö´ Unverified ‚Äî Auto-Listed from XRPL</span>
  <span>‚¨õ Expired ‚Äî Renewal Required</span>
</div>

<div class="view-filters">
  <span class="view-label">View:</span>
  <button class="view-pill active" data-filter="all">All</button>
  <button class="view-pill" data-filter="certified">Certified</button>
  <button class="view-pill" data-filter="verified">Verified</button>
  <button class="view-pill" data-filter="unverified">Unverified</button>
  <button class="view-pill" data-filter="expired">Expired</button>
</div>

<!-- Ledger -->
<main>
  <section id="ledger">
    <h2>üìú All Projects on The Ledger</h2>
    <div id="ledgerList"></div>
  </section>
</main>

<footer>¬© 2025 The RAD Ledger | Verified by Rad Garlington</footer>

<!-- MODAL -->
<div id="tokenModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>

    <div id="modalLogoWrap" style="text-align:center;margin-bottom:8px;display:none;">
      <img id="modalLogo" src="" alt="Project Logo"
           style="max-width:80px;max-height:80px;border-radius:12px;
                  box-shadow:0 2px 6px rgba(0,0,0,.25);object-fit:contain;">
    </div>

    <h2 id="modalToken">$RAD</h2>
    <p><strong>Certificate:</strong> <span id="modalCert"></span></p>
    <p><strong>Tier:</strong> <span id="modalTier"></span></p>
    <p><strong>Developer:</strong> <span id="modalDev"></span></p>
    <p><strong>Developer ùïè:</strong> <a id="modalDevX" href="#" target="_blank"></a></p>
    <p><strong>Doxxed:</strong> <span id="modalDoxxed"></span></p>
    <p><strong>Issuer:</strong> <span id="modalIssuer"></span></p>
    <p><strong>Website:</strong> <a id="modalWebsite" href="#" target="_blank"></a></p>
    <p><strong>Email:</strong> <span id="modalEmail"></span></p>
    <p><strong>Social:</strong> <a id="modalX" href="#" target="_blank">ùïè</a> | <a id="modalTG" href="#" target="_blank">Telegram</a></p>
    <p><strong>Seal NFT:</strong> <span id="modalNFT"></span></p>
  </div>
</div>

<script>
let allProjects = [];
let currentFilter = "all";
let modal = null;

/* Expired Check */
function isExpired(entry){
  if(!entry.expires_at) return false;
  const today = new Date().toISOString().slice(0,10);
  return entry.expires_at < today;
}

/* Category */
function getCategory(entry){
  const tier = (entry.tier || "").toLowerCase();
  if(tier === "certified") return "certified";
  if(tier === "verified") return isExpired(entry) ? "expired" : "verified";
  return "unverified";
}

/* Meta Line */
function getMeta(entry){
  if(entry.tier === "Certified"){
    return `Certified ¬∑ Unlimited`;
  }
  if(entry.tier === "Verified"){
    return isExpired(entry) ? "Expired" : "Verified";
  }
  if(entry.tier === "Unverified"){
    const iss = entry.issuers || [];
    if(iss.length === 0) return "Issuers: 0";
    if(iss.length === 1) return `Issuer: ${iss[0].issuer}`;
    return `Issuers: ${iss.length}`;
  }
  return "";
}

/* Icons */
function getIcon(category){
  if(category === "certified") return "üü°";
  if(category === "verified") return "üî∑";
  if(category === "expired") return "‚¨õ";
  return "‚ö´";
}

/* Render Ledger */
function renderLedger(){
  const ledger = document.getElementById("ledgerList");
  ledger.innerHTML = "";

  const grouped = {};

  allProjects.forEach(p => {
    if(currentFilter !== "all" && p.category !== currentFilter) return;

    const clean = (p.token || "").replace(/^\$/,"");
    const letter = (clean.charAt(0) || "#").toUpperCase();

    if(!grouped[letter]) grouped[letter] = [];
    grouped[letter].push(p);
  });

  const letters = Object.keys(grouped).sort();
  if(!letters.length){
    ledger.innerHTML = '<p>No projects found.</p>';
    return;
  }

  letters.forEach(letter => {
    const wrap = document.createElement("div");
    wrap.innerHTML = `<h3>${letter}</h3>`;
    const ul = document.createElement("ul");

    grouped[letter].forEach(entry => {
      const li = document.createElement("li");
      li.className = "entry";

      const icon = getIcon(entry.category);
      const meta = getMeta(entry);

      /* Unverified Expandable */
      if(entry.tier === "Unverified"){
        li.innerHTML = `
          <span style="font-weight:bold;">${icon} ${entry.token}</span>
          <span>${meta}</span>
        `;
        li.onclick = () => toggleIssuerGroup(entry);
      }
      else {
        const encoded = JSON.stringify(entry).replace(/'/g,"&#39;");
        li.setAttribute("data-token", encoded);
        li.innerHTML = `
          <span>${icon} ${entry.token}</span>
          <span>${meta}</span>
        `;
      }

      ul.appendChild(li);
    });

    wrap.appendChild(ul);
    ledger.appendChild(wrap);
  });
}

/* Expandable Issuer Group */
function toggleIssuerGroup(entry){
  const ledger = document.getElementById("ledgerList");
  const existing = document.getElementById("issuer-group-" + entry.token);
  if(existing){
    existing.remove();
    return;
  }

  const div = document.createElement("div");
  div.id = "issuer-group-" + entry.token;
  div.style.padding = "10px 20px 14px";

  const issuers = entry.issuers || [];
  let html = `<div style="margin-top:6px;">`;

  issuers.forEach(iss => {
    html += `
      <div style="padding:10px;margin-top:8px;
                  border:1px solid #d3dced;border-radius:8px;
                  background:#f9fbff;">
        <div><strong>Issuer:</strong> ${iss.issuer}</div>
        <div><strong>Domain:</strong> ${iss.domain || "‚Äî"}</div>
        <div><strong>Address:</strong> ${iss.issuer}</div>

        <div style="margin-top:6px;">
          <button onclick='openIssuerModal(${JSON.stringify(iss).replace(/'/g,"&#39;")}, "${entry.token}")'
            style="padding:6px 10px;border-radius:6px;
                   background:#0A74D0;color:#fff;
                   font-size:.8rem;cursor:pointer;">
            View Card
          </button>
        </div>
      </div>
    `;
  });

  html += `</div>`;
  div.innerHTML = html;

  /* Insert below clicked row */
  const allRows = Array.from(document.querySelectorAll("li.entry"));
  let target = null;
  allRows.forEach(li => {
    if(li.innerText.includes(entry.token)){
      target = li;
    }
  });

  if(target){
    target.after(div);
  }
}

/* Modal for Individual Issuer */
function openIssuerModal(issuer, token){
  const modal = document.getElementById("tokenModal");
  modal.style.display = "block";

  document.getElementById("modalLogoWrap").style.display = "none";
  document.getElementById("modalLogo").src = "";

  document.getElementById("modalToken").textContent = `${token} ‚Äî ${issuer.issuer}`;
  document.getElementById("modalCert").textContent = "XRPL-AUTO";
  document.getElementById("modalTier").textContent = "Unverified";
  document.getElementById("modalDev").textContent = "‚Äî";

  const devx = document.getElementById("modalDevX");
  devx.href = "#";
  devx.textContent = "";

  document.getElementById("modalDoxxed").innerHTML = "‚ùå Undoxxed";
  document.getElementById("modalIssuer").textContent = issuer.issuer;

  const web = document.getElementById("modalWebsite");
  web.textContent = issuer.domain || "‚Äî";
  web.href = issuer.domain ? "https://" + issuer.domain : "#";

  document.getElementById("modalEmail").textContent = "‚Äî";
  document.getElementById("modalX").href = "#";
  document.getElementById("modalTG").href = "#";
  document.getElementById("modalNFT").textContent = "‚Äî";
}

/* Load Ledger JSON */
async function loadLedger(){
  try{
    const res = await fetch("ledger.json", { cache:"no-store" });
    const data = await res.json();

    allProjects = data.map(entry => ({
      ...entry,
      category: getCategory(entry)
    }));

    renderLedger();
  }catch(err){
    console.error(err);
    document.getElementById("ledgerList").innerHTML = "Error loading ledger.";
  }
}

/* Modal Close Setup */
document.addEventListener("DOMContentLoaded", () => {
  modal = document.getElementById("tokenModal");
  const close = document.querySelector(".close");

  close.onclick = () => { modal.style.display = "none"; };
  window.onclick = e => { if(e.target === modal) modal.style.display = "none"; };

  const filterPills = document.querySelectorAll(".view-filters .view-pill");
  filterPills.forEach(pill => {
    pill.addEventListener("click", () => {
      currentFilter = pill.dataset.filter;
      filterPills.forEach(p => p.classList.toggle("active", p === pill));
      renderLedger();
    });
  });

  loadLedger();
});
</script>

</body>
</html>
