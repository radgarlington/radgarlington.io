<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>The RAD Ledger ‚Äî Source of Truth</title>
<style>
*{box-sizing:border-box}
body{margin:0;background:#fff;color:#0f172a;font-family:Arial,system-ui,sans-serif}
/* Banner */
.banner{background:linear-gradient(90deg,#0A74D0,#083c80);color:#fff;text-align:center;
  padding:20px 10px 18px;font-size:1.05rem;font-weight:600;line-height:1.4;
  border-bottom:2px solid #062a5c;box-shadow:0 4px 10px rgba(0,0,0,.25)}
.banner em{display:block;margin-top:6px;font-style:italic;font-weight:500;opacity:.85}
/* Header */
header{text-align:center;padding:52px 10px 20px;background:#eaf3ff;border-bottom:2px solid #d7e7ff;position:relative}
header h1{font-size:2.2rem;margin:0;color:#0A74D0}
header p{margin:10px 0 0;color:#334155}
/* Back button */
.back-btn{position:absolute;top:10px;left:18px;background:#0A74D0;color:#fff;
  padding:6px 10px;border-radius:6px;text-decoration:none;font-weight:600;font-size:.8rem;letter-spacing:.2px;
  transition:opacity .2s ease,transform .2s ease}
.back-btn:hover{opacity:.9;transform:translateY(-1px)}
/* Annual notice */
.annual{
  max-width:760px;
  margin:20px auto 24px;
  padding:14px 16px;
  border-radius:10px;
  border:1px solid #d4e1ff;
  background:#edf3ff;
  color:#0f172a;
  font-size:.95rem;
  line-height:1.5;
}
.annual ul{margin:6px 0 6px 18px;padding:0;list-style:disc}
/* Legend */
.legend{background:#f1f5fb;color:#0A74D0;text-align:center;font-size:.95rem;font-weight:600;
  padding:12px 8px;border-bottom:1px solid #d7e7ff;line-height:1.6}
.legend span{display:block;margin:4px 0}
/* View filters */
.view-filters{
  background:#eef2ff;
  border-bottom:2px solid #d7e7ff;
  padding:10px 12px;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
}
.view-label{
  font-size:.9rem;
  font-weight:600;
  color:#0A74D0;
}
.view-pill{
  border:none;
  border-radius:999px;
  padding:4px 10px;
  font-size:.85rem;
  cursor:pointer;
  background:#e5e7eb;
  color:#111827;
  font-weight:600;
  transition:background .15s ease,transform .15s ease;
}
.view-pill:hover{
  background:#d4d4d8;
  transform:translateY(-1px);
}
.view-pill.active{
  background:#0A74D0;
  color:#f9fafb;
}
/* Rug / Blacklist / Shill Links */
.rug-link-container{text-align:center;background:#fffbe6;border-bottom:2px solid #d7e7ff;padding:14px 0 22px}
.rug-link{display:inline-block;background:#facc15;color:#111827;font-weight:700;font-size:.95rem;text-decoration:none;
  padding:9px 18px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.25);border:2px solid #b45309;transition:all .2s ease}
.rug-link:hover{background:#fde047;transform:translateY(-2px) scale(1.02);box-shadow:0 3px 8px rgba(0,0,0,.3)}
/* Submit Link */
.submit-link{display:inline-block;background:#0A74D0;color:#fff;font-weight:600;font-size:.9rem;text-decoration:none;
  padding:8px 14px;border-radius:8px;margin:12px auto 24px;box-shadow:0 2px 5px rgba(0,0,0,.2);transition:background .2s ease,transform .2s ease}
.submit-link:hover{background:#094d9d;transform:translateY(-2px)}
.submit-link-container{text-align:center;background:#f9fbff;border-bottom:2px solid #d7e7ff;padding-bottom:20px}
main{max-width:900px;margin:30px auto;padding:0 16px}
h2{color:#0A74D0;border-bottom:1px solid #cbd5e1;padding-bottom:4px;font-size:1.3rem;margin-bottom:14px}
h3{color:#0A74D0;font-size:1.1rem;margin:10px 0}
ul{list-style:none;padding:0;margin:0}
li.entry{margin:6px 0;padding:8px 10px;border-bottom:1px dashed #cbd5e1;font-size:.95rem;
  display:flex;justify-content:space-between;align-items:center;cursor:pointer;border-radius:6px;transition:background .15s ease}
li.entry:hover{background:#f1f7ff}
li span{color:#475569;font-size:.85rem}
footer{text-align:center;padding:20px;border-top:2px solid #d7e7ff;color:#475569;font-size:.9rem}
/* Modal */
.modal{display:none;position:fixed;z-index:999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.55)}
.modal-content{background:#fff;color:#0f172a;margin:8% auto;padding:20px;border:2px solid #d0e3ff;border-radius:10px;width:90%;max-width:500px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.close{float:right;font-size:1.5rem;cursor:pointer;color:#0A74D0}
.close:hover{color:#083c80}
.modal-content a{color:#0A74D0;text-decoration:none;font-weight:bold}
.checkmark{color:#0A74D0;font-weight:bold}
</style>
</head>

<body>
<div class="banner">
  üöß The Ledger‚Äôs being built. Verified projects will appear soon.<br>Don‚Äôt rush perfection.
  <em>‚Äî Rad</em>
</div>

<header>
  <a href="/" class="back-btn">‚Üê Back</a>
  <h1>The RAD Ledger</h1>
  <p>The meme coin with a ledger ‚Äî certifying XRPL projects.</p>
</header>

<section class="annual">
  <strong>Listings, Certification & Renewals</strong>
  <p style="margin:8px 0 4px">
    The RAD Ledger separates <strong>Certified</strong> projects from <strong>Verified</strong> projects.
  </p>
  <ul>
    <li><strong>Certified</strong> listings are permanent unless downgraded for cause.</li>
    <li><strong>Verified</strong> listings are annual and must renew every 12 months.</li>
    <li>Renewals go through the same process as initial verification.</li>
  </ul>
  <p style="margin:6px 0 0">Expired listings must pass review again.</p>
</section>

<div class="legend">
  <span>üü° Certified ‚Äî Doxxed + Seal NFT</span>
  <span>üî∑ Verified ‚Äî Non-Doxxed</span>
  <span>‚ö´ Unverified ‚Äî Auto-Listed from XRPL</span>
  <span>‚¨õ Expired ‚Äî Renewal Required</span>
</div>

<div class="view-filters">
  <span class="view-label">View:</span>
  <button class="view-pill active" data-filter="all">All</button>
  <button class="view-pill" data-filter="certified">Certified</button>
  <button class="view-pill" data-filter="verified">Verified</button>
  <button class="view-pill" data-filter="unverified">Unverified</button>
  <button class="view-pill" data-filter="expired">Expired</button>
</div>

<div class="rug-link-container">
  <a href="/rugreport.html" class="rug-link">‚ö†Ô∏è The Rug Report ‚Äî View Flagged Projects ‚ö†Ô∏è</a>
</div>

<div class="rug-link-container" style="background:#ffe8e8;border-bottom:2px solid #d7e7ff;padding:16px 0 22px;">
  <a href="/blacklist.html" class="rug-link"
     style="background:#dc2626;color:#fff;border-color:#7f1d1d;">
    üõë THE BLACKLIST ‚Äî View Scammers üõë
  </a>
</div>

<div class="rug-link-container" style="background:#fff3e0;border-bottom:2px solid #d7e7ff;padding:16px 0 22px;">
  <a href="/shills.html" class="rug-link"
     style="background:#fb923c;color:#111827;border-color:#c2410c;">
    ü§° THE SHILL LIST ‚Äî View The Clowns ü§°
  </a>
</div>

<div class="submit-link-container">
  <a href="#submit-section" class="submit-link">üßæ Submit Your Token</a>
</div>

<main>
  <section id="ledger">
    <h2>üìú All Projects on The Ledger</h2>
    <div id="ledgerList"></div>
  </section>

  <section id="submit-section" class="submit-banner"
    style="background:#f0f7ff;border:2px solid #d0e3ff;border-radius:12px;padding:28px;text-align:center;margin:40px 0">
    <h2>üßæ Submit Your Token</h2>
    <p>Get your XRPL project officially verified by The RAD Ledger.</p>
    <a href="/submit.html" class="back-btn"
       style="position:relative;top:auto;left:auto;background:#0A74D0;padding:10px 16px;border-radius:8px;font-size:.9rem;">
       Submit for Verification
    </a>
  </section>
</main>

<footer>¬© 2025 The RAD Ledger | Verified by Rad Garlington</footer>

<div id="tokenModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <div id="modalLogoWrap" style="text-align:center;margin-bottom:8px;display:none;">
      <img id="modalLogo" src="" alt="Project Logo"
           style="max-width:80px;max-height:80px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.25);object-fit:contain;">
    </div>
    <h2 id="modalToken">$RAD</h2>
    <p><strong>Certificate:</strong> <span id="modalCert"></span></p>
    <p><strong>Tier:</strong> <span id="modalTier"></span></p>
    <p><strong>Developer:</strong> <span id="modalDev"></span></p>
    <p><strong>Developer ùïè:</strong> <a id="modalDevX" href="#" target="_blank"></a></p>
    <p><strong>Doxxed:</strong> <span id="modalDoxxed"></span></p>
    <p><strong>Issuer:</strong> <span id="modalIssuer"></span></p>
    <p><strong>Website:</strong> <a id="modalWebsite" href="#" target="_blank"></a></p>
    <p><strong>Email:</strong> <span id="modalEmail"></span></p>
    <p><strong>Social:</strong> <a id="modalX" href="#" target="_blank">ùïè</a> | <a id="modalTG" href="#" target="_blank">Telegram</a></p>
    <p><strong>Seal NFT:</strong> <span id="modalNFT"></span></p>
  </div>
</div>

<script>
let allProjects = [];
let currentFilter = "all";
let modal = null;

/* =========================
    CATEGORY + META LOGIC
========================= */
function isExpired(entry){
  if(!entry.expires_at) return false;
  const today = new Date().toISOString().slice(0,10);
  return entry.expires_at < today;
}

function getCategory(entry){
  const tier = (entry.tier || "").toLowerCase();
  if(tier === "certified") return "certified";
  if(tier === "verified") return isExpired(entry) ? "expired" : "verified";
  return "unverified";
}

function getMeta(entry){
  const cert = entry.cert || "XRPL-AUTO";
  const reg  = entry.registered_at || "‚Äî";
  const exp  = entry.expires_at || "‚Äî";
  const tier = (entry.tier || "").toLowerCase();

  if(tier === "certified")
    return `Cert: ${cert} ¬∑ Registered: ${reg} ¬∑ Status: Unlimited`;

  if(tier === "verified"){
    const expired = isExpired(entry);
    return `Cert: ${cert} ¬∑ Registered: ${reg} ¬∑ ${expired ? "Expired" : "Expires"}: ${exp}`;
  }

  return `Status: Auto-Listed from XRPL`;
}

function getIcon(category){
  if(category === "certified") return "üü°";
  if(category === "verified") return "üî∑";
  if(category === "expired") return "‚¨õ";
  return "‚ö´";
}

/* =========================
    GROUPED RENDER
========================= */
function renderLedger(){
  const ledger = document.getElementById("ledgerList");
  if(!ledger) return;

  ledger.innerHTML = "";

  // group by token symbol
  const grouped = {};
  allProjects.forEach(p => {
    if(currentFilter !== "all" && p.category !== currentFilter) return;

    const symbol = (p.token || "").toUpperCase();
    if(!grouped[symbol]){
      grouped[symbol] = { parents:[], issuers:[] };
    }

    if(p.grouped){
      grouped[symbol].parents.push(p);
      (p.issuers || []).forEach(i => grouped[symbol].issuers.push(i));
    } else {
      grouped[symbol].parents.push(p);
    }
  });

  const sorted = Object.keys(grouped).sort();

  if(!sorted.length){
    ledger.innerHTML = '<p style="color:#475569;font-size:.95rem;">No projects match this view yet.</p>';
    return;
  }

  sorted.forEach(symbol => {
    const entry = grouped[symbol];
    const parent = entry.parents[0];
    const icon = getIcon(parent.category);
    const meta = getMeta(parent);

    const isExpandable = entry.issuers.length > 0;

    let html = `
      <li class="entry parent-entry" data-token="${parent.tier === 'Certified' || parent.tier === 'Verified'
        ? JSON.stringify(parent).replace(/"/g,'&quot;')
        : ''}">
        <span>${icon} ${parent.token}</span>
        <span>${meta}</span>
        ${isExpandable ? `<span class="expander" style="margin-left:10px;color:#0A74D0;font-weight:bold;cursor:pointer;">‚ñº</span>` : ``}
      </li>
    `;

    if(isExpandable){
      html += `<ul class="issuer-list" style="display:none;margin-left:20px;">`;
      entry.issuers.forEach(iss => {
        html += `
          <li class="entry issuer-entry" style="background:#f7fbff;cursor:default;">
            <span style="font-size:.85rem;color:#475569;">Issuer</span>
            <span style="font-size:.85rem;color:#475569;">${iss}</span>
          </li>`;
      });
      html += `</ul>`;
    }

    ledger.insertAdjacentHTML("beforeend", html);
  });

  attachExpanders();
}

/* =========================
    DROPDOWN LOGIC
========================= */
function attachExpanders(){
  document.querySelectorAll(".expander").forEach(btn => {
    btn.addEventListener("click", () => {
      const issuerList = btn.parentElement.nextElementSibling;
      if(!issuerList) return;
      const open = issuerList.style.display === "block";
      issuerList.style.display = open ? "none" : "block";
      btn.textContent = open ? "‚ñº" : "‚ñ≤";
    });
  });
}

/* =========================
    MODAL HANDLING
========================= */
function openModal(data){
  const logoWrap = document.getElementById("modalLogoWrap");
  const logoImg  = document.getElementById("modalLogo");

  if(data.logo_url){
    logoImg.src = data.logo_url;
    logoWrap.style.display = "block";
  } else {
    logoImg.src = "";
    logoWrap.style.display = "none";
  }

  document.getElementById("modalToken").textContent  = data.token || "";
  document.getElementById("modalCert").textContent   = data.cert || "XRPL-AUTO";
  document.getElementById("modalTier").textContent   = data.tier || "Unverified";
  document.getElementById("modalDev").textContent    = data.dev || "‚Äî";

  const devXEl = document.getElementById("modalDevX");
  devXEl.href = data.devx || "#";

  if(data.devx){
    if(data.devx.includes("t.me")){
      devXEl.textContent = data.dev ? "@" + data.dev : data.devx;
    } else {
      devXEl.textContent = data.devx.replace("https://x.com/","@");
    }
  } else {
    devXEl.textContent = "";
  }

  document.getElementById("modalDoxxed").innerHTML = data.doxxed
    ? '<span class="checkmark">‚úÖ</span> Doxxed'
    : "‚ùå Undoxxed";

  document.getElementById("modalIssuer").textContent = data.issuer || "‚Äî";

  const webEl = document.getElementById("modalWebsite");
  webEl.textContent = data.website || "‚Äî";
  webEl.href        = data.website || "#";

  document.getElementById("modalEmail").textContent = data.email || "‚Äî";
  document.getElementById("modalX").href           = data.x || "#";
  document.getElementById("modalTG").href          = data.tg || "#";

  const nftEl = document.getElementById("modalNFT");
  nftEl.innerHTML = data.nft ? `<a href="${data.nft}" target="_blank">View Seal NFT</a>` : "‚Äî";

  modal.style.display = "block";
}

/* =========================
    CLICK HANDLER
========================= */
document.addEventListener("click", e => {
  const li = e.target.closest(".entry");
  if(!li) return;

  if(li.classList.contains("issuer-entry")) return;
  if(!li.dataset.token) return;

  let data;
  try{
    data = JSON.parse(li.dataset.token.replace(/&quot;/g,'"'));
  }catch{
    return;
  }

  openModal(data);
});

/* =========================
    LOAD + FILTER
========================= */
async function loadLedger(){
  const ledger = document.getElementById("ledgerList");
  if(!ledger) return;
  ledger.innerHTML = '<p style="color:#475569;font-size:.95rem;">Loading Ledger...</p>';

  try{
    const res = await fetch("ledger.json", { cache:"no-store" });
    if(!res.ok) throw new Error("Failed to load ledger.json");
    const data = await res.json();

    allProjects = (Array.isArray(data) ? data : []).map(entry => ({
      ...entry,
      category: getCategory(entry)
    })).sort((a,b) => (a.token || "").localeCompare(b.token || ""));

    renderLedger();
  }catch(err){
    ledger.innerHTML = '<p style="color:#b91c1c;font-weight:600;">Error loading Ledger.</p>';
  }
}

document.addEventListener("DOMContentLoaded", () => {
  modal = document.getElementById("tokenModal");

  const close = document.querySelector(".close");
  if(close) close.onclick = () => { modal.style.display = "none"; };

  window.onclick = e => { if(e.target === modal) modal.style.display = "none"; };

  document.querySelectorAll(".view-pill").forEach(pill => {
    pill.addEventListener("click", () => {
      currentFilter = pill.dataset.filter;
      document.querySelectorAll(".view-pill").forEach(p => p.classList.toggle("active", p === pill));
      renderLedger();
    });
  });

  loadLedger();
});
</script>


</body>
</html>
