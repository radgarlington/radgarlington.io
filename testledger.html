<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The RAD Ledger ‚Äî Source of Truth</title>

<style>
*{box-sizing:border-box}
body{margin:0;background:#fff;color:#0f172a;font-family:Arial,system-ui,sans-serif}

/* ====================================== */
/*            RAD BUTTONS (CLEAN)         */
/* ====================================== */
.rad-btn {
  position:relative;
  overflow:hidden;
  color:#f9fafb;
  font-weight:700;
  padding:11px 20px;
  font-size:.9rem;
  border-radius:12px;
  text-decoration:none;
  display:flex;
  align-items:center;
  gap:8px;
  box-shadow:0 3px 10px rgba(15,23,42,.25);
  background:linear-gradient(145deg,#0f7cf0,#07418f);
  border:1px solid #06336f;
  cursor:pointer;
  transition:transform .15s ease, box-shadow .15s ease, filter .15s ease;
}
.rad-btn::before{
  content:"";
  position:absolute;
  top:-60%;
  left:-10%;
  width:130%;
  height:80%;
  background:linear-gradient(120deg,rgba(255,255,255,.6),rgba(255,255,255,0));
  opacity:.25;
  transform:skewY(-12deg);
  transition:transform .25s ease, opacity .2s ease;
}
.rad-btn span{position:relative;z-index:1;}
.rad-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 18px rgba(15,23,42,.35);
  filter:brightness(1.03);
}
.rad-btn:hover::before{
  transform:skewY(-12deg) translateY(35%);
  opacity:.35;
}

/* ====================================== */
/*          TOP ACTION BAR                */
/* ====================================== */
.top-actions{
  display:flex;
  justify-content:space-between;
  align-items:center;
  max-width:960px;
  margin:10px auto 6px;
  padding:0 12px;
}
.top-actions .rad-btn{
  padding:8px 16px;
  font-size:.85rem;
}

/* ====================================== */
/*                BANNER                  */
/* ====================================== */
.banner{
  background:linear-gradient(90deg,#0A74D0,#083c80);
  color:#fff;text-align:center;
  padding:20px 10px 18px;
  font-size:1.05rem;font-weight:600;line-height:1.4;
  border-bottom:2px solid #062a5c;
  box-shadow:0 4px 10px rgba(0,0,0,.25)
}
.banner em{
  display:block;margin-top:6px;
  font-style:italic;font-weight:500;opacity:.85
}

/* ====================================== */
/*               HEADER                   */
/* ====================================== */
header{
  text-align:center;
  padding:42px 10px 16px;
  background:#eaf3ff;
  border-bottom:2px solid #d7e7ff;
}
header h1{
  font-size:2rem;margin:0;color:#0A74D0
}
header p{
  margin:8px 0 0;color:#334155
}

/* ====================================== */
/*      BUTTON ACTION AREAS (NEW LAYOUT)  */
/* ====================================== */
.rad-actions {
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  gap:16px;
  padding:18px 10px;
  background:#f8fbff;
  border-bottom:2px solid #d7e7ff;
}

/* SECTION HEADS */
.section-title {
  font-weight:700;
  font-size:1rem;
  margin-bottom:6px;
  color:#0A74D0;
}

/* ====================================== */
/*          LISTING POLICY BOX            */
/* ====================================== */
.annual{
  max-width:820px;
  margin:20px auto 24px;
  padding:14px 16px;
  border-radius:10px;
  border:1px solid #d4e1ff;
  background:#edf3ff;
  color:#0f172a;
  font-size:.95rem;
  line-height:1.5;
}
.annual ul{margin:6px 0 6px 18px;padding:0;list-style:disc}

/* ====================================== */
/*                LEGEND                  */
/* ====================================== */
.legend{
  background:#f1f5fb;
  color:#0A74D0;
  text-align:center;
  font-size:.95rem;
  font-weight:600;
  padding:12px 8px;
  border-bottom:1px solid #d7e7ff;
  line-height:1.6;
}
.legend span{display:block;margin:4px 0}

/* ====================================== */
/*               FILTERS                  */
/* ====================================== */
.view-filters{
  background:#eef2ff;
  border-bottom:2px solid #d7e7ff;
  padding:12px 12px;
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  gap:10px;
}
.view-label{font-size:.9rem;font-weight:600;color:#0A74D0}
.view-pill{
  border:none;
  border-radius:999px;
  padding:4px 12px;
  font-size:.85rem;
  cursor:pointer;
  background:#e5e7eb;
  color:#111827;
  font-weight:600;
  transition:background .15s ease,transform .15s ease;
}
.view-pill:hover{background:#d4d4d8;transform:translateY(-1px)}
.view-pill.active{background:#0A74D0;color:#f9fafb}

/* ====================================== */
/*              LEDGER LIST               */
/* ====================================== */
main{
  max-width:860px;
  margin:30px auto;
  padding:0 14px;
}
h2{
  color:#0A74D0;
  border-bottom:1px solid #cbd5e1;
  padding-bottom:4px;
  font-size:1.3rem;
  margin-bottom:14px;
}
h3{
  color:#0A74D0;
  font-size:1.1rem;
  margin:10px 0;
}
ul{list-style:none;padding:0;margin:0}

li.entry{
  margin:6px 0;
  padding:10px 12px;
  border-bottom:1px dashed #cbd5e1;
  font-size:.95rem;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  border-radius:6px;
  transition:background .15s ease;
}
li.entry:hover{background:#f1f7ff}
li span{color:#475569;font-size:.85rem}

/* ====================================== */
/*                 FOOTER                 */
/* ====================================== */
footer{
  text-align:center;
  padding:20px;
  border-top:2px solid #d7e7ff;
  color:#475569;
  font-size:.9rem;
}

/* ====================================== */
/*              PROJECT MODAL             */
/* ====================================== */
.modal{
  display:none;
  position:fixed;
  z-index:999;
  left:0;
  top:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,.55);
}
.modal-content{
  background:#fff;
  color:#0f172a;
  margin:5% auto;
  padding:20px;
  border:2px solid #d0e3ff;
  border-radius:10px;
  width:90%;
  max-width:500px;
  max-height:82vh;
  overflow-y:auto;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
}
.close{
  float:right;
  font-size:1.5rem;
  cursor:pointer;
  color:#0A74D0;
}
.close:hover{color:#083c80}
</style>
</head>

<body>

<!-- TOP ACTIONS -->
<div class="top-actions">
  <a href="/" class="rad-btn"><span>‚Üê Back</span></a>
  <a href="index.html" class="rad-btn"><span>$BUY RAD</span></a>
</div>

<div class="banner">
  üöß The Ledger‚Äôs being built. Verified projects will appear soon.<br>
  Don‚Äôt rush perfection.
  <em>‚Äî Rad</em>
</div>

<header>
  <h1>The RAD Ledger</h1>
  <p>The meme coin with a ledger ‚Äî certifying XRPL projects.</p>
</header>

<!-- EDUCATION -->
<div class="rad-actions" style="padding:20px 10px 6px;">
  <a href="education.html" class="rad-btn">
    <span>üéì Ledger Education Hub ‚Äî Learn the System</span>
  </a>
</div>

<!-- ENFORCEMENT -->
<div class="rad-actions" style="background:#f3f0ff;border-bottom:2px solid #d6c9ff;">
  <a href="rugreport.html" class="rad-btn"><span>üß® Rug Report</span></a>
  <a href="blacklist.html" class="rad-btn"><span>üö´ Blacklist</span></a>
  <a href="threat-actors.html" class="rad-btn"><span>üö´ Threat Actors Directory</span></a>
  <a href="shills.html" class="rad-btn"><span>üì¢ Shills</span></a>
</div>

<!-- ================================= -->
<!--   NFT LISTINGS + TERMINAL BUTTON  -->
<!-- ================================= -->
<div class="rad-actions" style="padding:22px 10px 18px;background:#eef6ff;border-bottom:2px solid #d7e7ff;">
  <a href="nfts.html" class="rad-btn rad-gold-btn"><span>üÉè NFT Listings</span></a>

  <button id="openRadTerminal" class="rad-btn rad-terminal-btn rad-malfunction" style="cursor:pointer;">
    <span>üñ•Ô∏è Launch RAD Terminal</span>
  </button>
</div>

<!-- LISTING POLICY -->
<section class="annual">
  <strong>Listings, Certification & Renewals</strong>
  <p style="margin:8px 0 4px">
    The RAD Ledger separates <strong>Certified</strong> projects from <strong>Verified</strong> projects.
  </p>
  <ul>
    <li><strong>Certified</strong> listings are permanent.</li>
    <li><strong>Verified</strong> listings must renew annually.</li>
    <li>Expired listings must be re-reviewed.</li>
  </ul>

  <p style="margin:8px 0 0;">
    <strong>Certification Policy.</strong>
    Certified projects are backed by a vault-locked Seal NFT held in the RAD certification wallet.
    If a project violates trust, the seal is revoked and may be burned on-chain.
  </p>
</section>

<!-- SUBMIT / RENEW -->
<div class="rad-actions" style="background:#f8fbff;border-top:0;border-bottom:2px solid #d7e7ff;">
  <a href="submit.html" class="rad-btn"><span>‚ûï Submit Token</span></a>
  <a href="submit.html" class="rad-btn"><span>üîÑ Renew Listing</span></a>
</div>

<div class="legend">
  <span>üü° Certified ‚Äî Doxxed + Seal NFT</span>
  <span>üî∑ Verified ‚Äî Non-Doxxed</span>
  <span>‚ö´ Unverified ‚Äî Auto-Listed from XRPL</span>
  <span>‚¨õ Expired ‚Äî Renewal Required</span>
</div>

<!-- FILTERS -->
<div class="view-filters">
  <span class="view-label">View:</span>
  <button class="view-pill active" data-filter="all">All</button>
  <button class="view-pill" data-filter="certified">Certified</button>
  <button class="view-pill" data-filter="verified">Verified</button>
  <button class="view-pill" data-filter="unverified">Unverified</button>
  <button class="view-pill" data-filter="expired">Expired</button>
</div>

<main>
  <section id="ledger">
    <h2>üìú All Projects on The Ledger</h2>
    <div id="ledgerList"></div>
  </section>
</main>

<footer>
  ¬© 2025 The RAD Ledger | Verified by Rad Garlington
</footer>

<!-- ============= MODAL ============= -->
<div id="tokenModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>

    <div id="modalLogoWrap" style="text-align:center;margin-bottom:8px;display:none;">
      <img id="modalLogo" src="" style="max-width:80px;border-radius:12px;">
    </div>

    <h2 id="modalToken">$RAD</h2>
    <p><strong>Certificate:</strong> <span id="modalCert"></span></p>
    <p><strong>Tier:</strong> <span id="modalTier"></span></p>
    <p><strong>Developer:</strong> <span id="modalDev"></span></p>
    <p><strong>Developer ùïè:</strong> <a id="modalDevX" href="#" target="_blank"></a></p>
    <p><strong>Doxxed:</strong> <span id="modalDoxxed"></span></p>
    <p><strong>Issuer:</strong> <span id="modalIssuer"></span></p>
    <p><strong>Website:</strong> <a id="modalWebsite" href="#" target="_blank"></a></p>
    <p><strong>Email:</strong> <span id="modalEmail"></span></p>

    <p><strong>Social:</strong>
      <a id="modalX" href="#" target="_blank">ùïè</a> |
      <a id="modalTG" href="#" target="_blank">Telegram</a>
    </p>

    <p><strong>Seal NFT:</strong> <span id="modalNFT"></span></p>
    <p><strong>Seal Image:</strong> <span id="modalNFTImage"></span></p>

    <div id="modalNFTPreviewWrap" style="display:none;text-align:center;margin-top:10px;">
      <img id="modalNFTPreview" src="" style="max-width:100%;width:260px;">
    </div>
  </div>
</div>

<!-- ====================================== -->
<!--           RAD TERMINAL OVERLAY         -->
<!-- ====================================== -->

<style>
/* FULLSCREEN OVERLAY */
#radTerminalOverlay {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.90);
  z-index:99999;
  padding:40px 20px;
}

/* SMALLER TERMINAL WINDOW (80%) */
#radTerminalWindow {
  width:80%;
  max-width:940px;
  margin:0 auto;
  background:#0b0f1a;
  border:2px solid #1e3a8a;
  padding:0;
  height:82vh;
  display:flex;
  flex-direction:column;
  box-shadow:0 0 40px rgba(0,80,255,0.35);
  position:relative;
}

/* TERMINAL HEADER */
#radTerminalHeader {
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#0d1220;
  padding:12px 16px;
  border-bottom:2px solid #1e3a8a;
  color:#77b0ff;
  font-family:"Courier New",monospace;
  font-size:15px;
}

/* CLOSE BUTTON */
#closeRadTerminal {
  background:none;
  border:none;
  color:#77b0ff;
  font-size:20px;
  cursor:pointer;
}

/* HELP ICON */
#openRadHelp {
  background:none;
  border:none;
  color:#77b0ff;
  font-size:17px;
  margin-left:12px;
  cursor:pointer;
}

#openRadHelp:hover,
#closeRadTerminal:hover {
  color:#a8ceff;
}

/* TERMINAL OUTPUT */
#rad-terminal {
  flex:1;
  overflow-y:auto;
  padding:14px;
  color:#a8ceff;
  font-family:"Courier New",monospace;
  font-size:15px;
  white-space:pre-wrap;
  border-bottom:2px solid #1e3a8a;
}

/* INPUT LINE */
.rad-input-line {
  display:flex;
  align-items:center;
  background:#0d1220;
  padding:10px;
  border-top:2px solid #1e3a8a;
}
.prompt {
  color:#77b0ff;
  margin-right:8px;
  font-family:"Courier New",monospace;
}
#rad-terminal-input {
  flex:1;
  background:transparent;
  border:none;
  outline:none;
  color:#a8ceff;
  font-family:"Courier New",monospace;
  font-size:15px;
}

/* PRINT LINE FX */
.rad-line {
  animation:flicker .12s linear 1
}
@keyframes flicker { 
  0%{opacity:.25} 
  100%{opacity:1}
}

/* ====================================== */
/*              SIDE DRAWER               */
/* ====================================== */
#radHelpDrawer {
  position:absolute;
  top:0;
  right:-360px;
  width:360px;
  height:100%;
  background:#10172b;
  border-left:2px solid #1e3a8a;
  padding:20px;
  color:#a8ceff;
  font-family:"Courier New",monospace;
  font-size:14px;
  overflow-y:auto;
  transition:right .25s ease;
  z-index:999999;
}

#radHelpDrawer.open {
  right:0;
}

#closeHelpDrawer {
  background:none;
  border:none;
  color:#77b0ff;
  font-size:18px;
  cursor:pointer;
  float:right;
}
#closeHelpDrawer:hover { 
  color:#a8ceff; 
}

.rad-help-title {
  font-weight:bold;
  color:#77b0ff;
  margin-top:12px;
  margin-bottom:6px;
  font-size:14px;
}

/* ====================================== */
/*      TERMINAL MALFUNCTION EFFECT       */
/* ====================================== */

.rad-terminal-btn {
  animation: radLightning 4.5s infinite;
}




@keyframes radLightning {
  0%   { filter:brightness(1) contrast(1); transform:scale(1); }

  /* micro flicker */
  4%   { filter:brightness(0); }
  5%   { filter:brightness(1.3); }

  /* lightning pop */
  11%  { filter:brightness(2.2) contrast(1.2); transform:scale(1.02); }
  12%  { filter:brightness(0) contrast(1.5); transform:scale(.98); }

  /* idle recover */
  22%  { filter:brightness(1); transform:scale(1); }

  /* random blackout flick */
  34%  { filter:brightness(.2); }
  36%  { filter:brightness(1.2); }

  /* surge pop */
  48%  { filter:brightness(2.0) contrast(1.25); transform:scale(1.02); }
  49%  { filter:brightness(0) contrast(1.5); transform:scale(.98); }

  /* long calm zone */
  60%  { filter:brightness(1); }

  /* triple blackout stutter (slower) */
  70%  { filter:brightness(0); }
  72%  { filter:brightness(1.4); }
  74%  { filter:brightness(0); }
  76%  { filter:brightness(1.2); }

  /* late glitch */
  88%  { filter:brightness(.3); }
  93%  { filter:brightness(2.0); }

  100% { filter:brightness(1); transform:scale(1); }
}






/* ====================================== */
/*       NFT BUTTON ‚Äî GOLD SHEEN SWEEP    */
/* ====================================== */

.rad-btn.rad-gold-btn {
  background: linear-gradient(145deg,#eac058,#a87c1f);
  border: 1px solid #d1a84a;
  color:#121113 !important;
  position:relative;
  overflow:hidden;
  box-shadow:none !important;
  animation:none !important;
}

/* Sheen */
.rad-btn.rad-gold-btn::after {
  content:"";
  position:absolute;
  top:0;
  left:-150%;
  width:130%;
  height:100%;
  background:linear-gradient(120deg,
    rgba(255,255,255,0.4),
    rgba(255,255,255,0)
  );
  transform:skewX(-20deg);
  animation:goldSheen 2.8s infinite;
}

@keyframes goldSheen {
  0%   { left:-150%; }
  55%  { left:-150%; }
  75%  { left:120%; }
  100% { left:120%; }
}

</style>


<!-- ================================ -->
<!--     TERMINAL HTML STRUCTURE      -->
<!-- ================================ -->
<div id="radTerminalOverlay">
  <div id="radTerminalWindow">

    <div id="radTerminalHeader">
      <span>RAD TERMINAL ‚Äî XRPL QUERY INTERFACE</span>

      <div style="display:flex;align-items:center;gap:10px;">
        <button id="openRadHelp">?</button>
        <button id="closeRadTerminal">‚úï</button>
      </div>
    </div>

    <div id="rad-terminal"></div>

    <div class="rad-input-line">
      <span class="prompt">rad@ledger:~$</span>
      <input id="rad-terminal-input" autocomplete="off">
    </div>

    <!-- SIDE DRAWER -->
    <div id="radHelpDrawer">
      <button id="closeHelpDrawer">‚úï</button>

      <div class="rad-help-title">RAD TERMINAL ‚Äî OPS MANUAL</div>
      <p>Welcome to the XRPL Query Interface. This console queries token metadata from the RAD Ledger.</p>

      <div class="rad-help-title">COMMANDS</div>
      <p>check &lt;token&gt; ‚Äî Query a token<br>
         clear ‚Äî Reset terminal<br>
         help ‚Äî Show basic command list</p>

      <div class="rad-help-title">USAGE</div>
      <p>check RAD<br>
         check BAG<br>
         check XRP</p>

      <div class="rad-help-title">OUTPUT FIELDS</div>
      <p>Status<br>
         Certificate<br>
         Issuer<br>
         Website<br>
         Holders<br>
         AMM Pool<br>
         Rug Score</p>

      <div class="rad-help-title">NOTES</div>
      <p>‚Ä¢ Use tickers with or without $ sign.<br>
         ‚Ä¢ Certified and Verified tokens return enhanced metadata.<br>
         ‚Ä¢ Unverified entries reflect raw XRPL issuer data.</p>

    </div>

  </div>
</div>

<script>

/* ========================================= */
/*               GLOBALS                     */
/* ========================================= */

let allProjects = [];
let currentFilter = "all";
const defaultUnverifiedLogo = "assets/RAD_ledger.png";

/* ========================================= */
/*             TERMINAL LEDGER LOAD          */
/* ========================================= */
let LEDGER_DB = {};

async function loadTerminalLedger() {
  try {
    const res = await fetch("ledger.json", { cache:"no-store" });
    const data = await res.json();

    data.forEach(e => {
      const key = e.token.toUpperCase().replace("$","");
      LEDGER_DB[key] = {
        status: e.tier ? e.tier.toUpperCase() : "UNVERIFIED",
        issuer: e.issuer || "‚Äî",
        website: e.website || "‚Äî",
        cert: e.cert || "‚Äî",
        holders: e.holders || "‚Äî",
        amm: e.amm || "‚Äî",
        rug: e.rug || "‚Äî"
      };
    });
  } catch(err){
    console.error("Terminal ledger load failed", err);
  }
}

/* ========================================= */
/*             TERMINAL INTERFACE            */
/* ========================================= */

const overlay = document.getElementById("radTerminalOverlay");
const openBtn = document.getElementById("openRadTerminal");
const closeBtn = document.getElementById("closeRadTerminal");
const terminal = document.getElementById("rad-terminal");
const input = document.getElementById("rad-terminal-input");

openBtn.onclick = async () => {
  overlay.style.display = "block";
  await loadTerminalLedger();
  bootTerminal();
  input.focus();
};
closeBtn.onclick = () => overlay.style.display = "none";

/* TERMINAL BOOT SEQUENCE */
function bootTerminal(){
  terminal.innerHTML = "";
  printLine("[BOOT] Initializing RAD Terminal...");
  printLine("[BOOT] Accessing XRPL Ledger...");
  printLine("[BOOT] Certification Matrix Loaded.");
  printLine("");
  printLine("rad@ledger:~$ Type 'help' for commands");
  printLine("");
}

/* PRINT LINE */
function printLine(t){
  const div = document.createElement("div");
  div.classList.add("rad-line");
  div.textContent = t;
  terminal.appendChild(div);
  terminal.scrollTop = terminal.scrollHeight;
}

/* COMMAND HANDLER */
input.addEventListener("keydown", e => {
  if(e.key === "Enter"){
    runCommand(input.value);
    input.value = "";
  }
});

function runCommand(cmdRaw){
  const cmd = cmdRaw.trim();
  if(!cmd) return;
  printLine("rad@ledger:~$ " + cmd);

  const parts = cmd.split(" ");
  const action = parts[0].toLowerCase();
  const arg = parts.slice(1).join(" ");

  if(action === "help")  return showHelp();
  if(action === "clear") return bootTerminal();
  if(action === "check") return checkToken(arg);

  printLine("Unknown command. Type 'help'");
}

function showHelp(){
  printLine("");
  printLine("Commands:");
  printLine("check <token>  ‚Äî Query XRPL token");
  printLine("clear          ‚Äî Reset terminal");
  printLine("help           ‚Äî Show help");
  printLine("");
}

/* TOKEN CHECK */
function checkToken(raw){
  if(!raw){
    printLine("Usage: check <token>");
    return;
  }

  const key = raw.toUpperCase().replace("$","").trim();
  const t = LEDGER_DB[key];

  if(!t){
    printLine("");
    printLine("Token not found in RAD Ledger.");
    printLine("");
    return;
  }

  printLine("");
  printLine("Token: " + key);
  printLine("Status: " + t.status);
  printLine("Issuer: " + t.issuer);
  printLine("Website: " + t.website);
  printLine("Certificate: " + t.cert);
  printLine("Holders: " + t.holders);
  printLine("AMM Pool: " + t.amm);
  printLine("Rug Score: " + t.rug);
  printLine("");
}

/* ========================================= */
/*         SIDE DRAWER ‚Äî HELP MANUAL         */
/* ========================================= */

const drawer = document.getElementById("radHelpDrawer");
const openHelp = document.getElementById("openRadHelp");
const closeHelp = document.getElementById("closeHelpDrawer");

openHelp.onclick = () => drawer.classList.add("open");
closeHelp.onclick = () => drawer.classList.remove("open");

/* Close drawer when clicking outside */
document.addEventListener("click", e => {
  const insideDrawer = drawer.contains(e.target);
  const insideButton = openHelp.contains(e.target);
  if(!insideDrawer && !insideButton && drawer.classList.contains("open")){
    drawer.classList.remove("open");
  }
});

/* ========================================= */
/*             LEDGER DISPLAY LOGIC          */
/* ========================================= */

function isExpired(entry){
  if(!entry.expires_at) return false;
  const today = new Date().toISOString().slice(0,10);
  return entry.expires_at < today;
}

function getCategory(entry){
  const t = (entry.tier || "").toLowerCase();
  if(t === "certified") return "certified";
  if(t === "verified") return isExpired(entry) ? "expired" : "verified";
  return "unverified";
}

function getMeta(entry){
  const t = (entry.tier||"").toLowerCase();
  const issuers = entry.issuers || [];

  if(t==="certified") return "Certified ¬∑ Unlimited";
  if(t==="verified") return isExpired(entry) ? "Expired" : "Verified";

  if(t==="unverified"){
    if(issuers.length===0) return "Issuer: undefined";
    if(issuers.length===1) return `Issuer: ${issuers[0].issuer}`;
    return `Issuers: ${issuers.length}`;
  }
  return "";
}

function getIcon(cat){
  if(cat==="certified") return "üü°";
  if(cat==="verified") return "üî∑";
  if(cat==="expired") return "‚¨õ";
  return "‚ö´";
}

function renderLedger(){
  const ledger = document.getElementById("ledgerList");
  ledger.innerHTML = "";

  const grouped = {};

  allProjects.forEach(p=>{
    if(currentFilter!=="all" && p.category!==currentFilter) return;

    const letter = (p.token.replace("$","")[0]||"#").toUpperCase();
    if(!grouped[letter]) grouped[letter]=[];
    grouped[letter].push(p);
  });

  Object.keys(grouped).sort().forEach(letter=>{
    const wrap = document.createElement("div");
    wrap.innerHTML = `<h3>${letter}</h3>`;
    const ul = document.createElement("ul");

    grouped[letter].forEach(entry=>{
      const li = document.createElement("li");
      li.className="entry";

      const tier=(entry.tier||"").toLowerCase();
      const icon=getIcon(entry.category);
      const meta=getMeta(entry);
      const isCertified=tier==="certified";

      li.innerHTML = `
        <span class="${isCertified?"certified-bold":""}">
          ${icon} ${entry.token}
        </span>
        <span>${meta}</span>
      `;

      const issuers=entry.issuers||[];

      if(tier==="certified"||tier==="verified"){
        li.onclick=()=>openVerifiedCard(entry);
      } else {
        if(issuers.length===0){
          li.onclick=()=>openUndefinedIssuer(entry);
        } else if(issuers.length===1){
          li.onclick=()=>openIssuerModal(issuers[0],entry.token);
        } else {
          li.onclick=()=>toggleIssuerGroup(entry);
        }
      }

      ul.appendChild(li);
    });

    wrap.appendChild(ul);
    ledger.appendChild(wrap);
  });
}

/* ========================================= */
/*                ISSUER MODALS             */
/* ========================================= */

function toggleIssuerGroup(entry){
  const id="issuer-group-"+entry.token;
  const exist=document.getElementById(id);
  if(exist){exist.remove();return;}

  const div=document.createElement("div");
  div.id=id;
  div.style.padding="10px 20px 14px";

  let html=`<div style="margin-top:6px;">`;

  entry.issuers.forEach(iss=>{
    const encoded=JSON.stringify(iss).replace(/'/g,"&#39;");
    html+=`
      <div style="padding:10px;margin-top:8px;border:1px solid #d3dced;border-radius:8px;background:#f9fbff;">
        <div><strong>Issuer:</strong> ${iss.issuer}</div>
        <div><strong>Domain:</strong> ${iss.domain||"‚Äî"}</div>
        <button onclick='openIssuerModal(${encoded},"${entry.token}")'
          style="margin-top:6px;padding:6px 10px;border-radius:6px;background:#0A74D0;color:#fff;font-size:.8rem;cursor:pointer;">
          View Card
        </button>
      </div>`;
  });

  html+=`</div>`;
  div.innerHTML=html;

  const rows=Array.from(document.querySelectorAll("li.entry"));
  for(const li of rows){
    if(li.innerText.includes(entry.token)){
      li.after(div);
      break;
    }
  }
}

function openUndefinedIssuer(entry){
  const modal=document.getElementById("tokenModal");
  modal.style.display="block";

  document.getElementById("modalLogoWrap").style.display="block";
  document.getElementById("modalLogo").src=defaultUnverifiedLogo;

  document.getElementById("modalToken").textContent=`${entry.token} ‚Äî Issuer: undefined`;
  document.getElementById("modalCert").textContent="XRPL-AUTO";
  document.getElementById("modalTier").textContent="Unverified";
  document.getElementById("modalDev").textContent="‚Äî";
  document.getElementById("modalDevX").textContent="";
  document.getElementById("modalDevX").href="#";

  document.getElementById("modalDoxxed").innerHTML="‚ùå Undoxxed";
  document.getElementById("modalIssuer").textContent="undefined";
  document.getElementById("modalWebsite").textContent="‚Äî";
  document.getElementById("modalWebsite").href="#";
  document.getElementById("modalEmail").textContent="‚Äî";
  document.getElementById("modalX").href="#";
  document.getElementById("modalTG").href="#";
  document.getElementById("modalNFT").textContent="‚Äî";
  document.getElementById("modalNFTImage").textContent="‚Äî";

  document.getElementById("modalNFTPreviewWrap").style.display="none";
  document.getElementById("modalNFTPreview").src="";
}

function openVerifiedCard(data){
  const modal=document.getElementById("tokenModal");
  modal.style.display="block";

  const wrap=document.getElementById("modalLogoWrap");
  const img=document.getElementById("modalLogo");

  if(data.logo_url){
    wrap.style.display="block";
    img.src=data.logo_url;
  } else {
    wrap.style.display="block";
    img.src=defaultUnverifiedLogo;
  }

  document.getElementById("modalToken").textContent=data.token;
  document.getElementById("modalCert").textContent=data.cert||"‚Äî";
  document.getElementById("modalTier").textContent=data.tier||"‚Äî";
  document.getElementById("modalDev").textContent=data.dev||"‚Äî";

  const dx=document.getElementById("modalDevX");
  dx.href=data.devx||"#";
  dx.textContent=data.devx?data.devx.replace("https://x.com/","@"):"";

  document.getElementById("modalDoxxed").innerHTML=data.doxxed?"‚úÖ Doxxed":"‚ùå Undoxxed";
  document.getElementById("modalIssuer").textContent=data.issuer||"‚Äî";

  const web=document.getElementById("modalWebsite");
  web.textContent=data.website||"‚Äî";
  web.href=data.website||"#";

  document.getElementById("modalEmail").textContent=data.email||"‚Äî";
  document.getElementById("modalX").href=data.x||"#";
  document.getElementById("modalTG").href=data.tg||"#";

  const nft=document.getElementById("modalNFT");
  const nftImgSpan=document.getElementById("modalNFTImage");
  const nftPrevWrap=document.getElementById("modalNFTPreviewWrap");
  const nftPrev=document.getElementById("modalNFTPreview");

  if(data.nft){
    nft.innerHTML=`<a href="${data.nft}" target="_blank">View on XRPSCAN</a>`;
  } else { nft.textContent="‚Äî"; }

  if(data.nft_image){
    nftImgSpan.innerHTML=`<a href="${data.nft_image}" target="_blank">View NFT Image</a>`;
    nftPrevWrap.style.display="block";
    nftPrev.src=data.nft_image;
  } else {
    nftImgSpan.textContent="‚Äî";
    nftPrevWrap.style.display="none";
    nftPrev.src="";
  }
}

function openIssuerModal(issuer,token){
  const modal=document.getElementById("tokenModal");
  modal.style.display="block";

  document.getElementById("modalLogoWrap").style.display="block";
  document.getElementById("modalLogo").src=defaultUnverifiedLogo;

  document.getElementById("modalToken").textContent=`${token} ‚Äî ${issuer.issuer}`;
  document.getElementById("modalCert").textContent="XRPL-AUTO";
  document.getElementById("modalTier").textContent="Unverified";
  document.getElementById("modalDev").textContent="‚Äî";

  const dx=document.getElementById("modalDevX");
  dx.href="#";
  dx.textContent="";

  document.getElementById("modalDoxxed").innerHTML="‚ùå Undoxxed";
  document.getElementById("modalIssuer").textContent=issuer.issuer;

  const w=document.getElementById("modalWebsite");
  w.textContent=issuer.domain||"‚Äî";
  w.href=issuer.domain?"https://"+issuer.domain:"#";

  document.getElementById("modalEmail").textContent="‚Äî";
  document.getElementById("modalX").href="#";
  document.getElementById("modalTG").href="#";
  document.getElementById("modalNFT").textContent="‚Äî";
  document.getElementById("modalNFTImage").textContent="‚Äî";

  document.getElementById("modalNFTPreviewWrap").style.display="none";
  document.getElementById("modalNFTPreview").src="";
}

/* ========================================= */
/*                 INIT LOAD                */
/* ========================================= */

document.addEventListener("DOMContentLoaded",()=>{

  modal=document.getElementById("tokenModal");

  document.querySelector(".close").onclick=()=>modal.style.display="none";

  window.onclick=e=>{
    if(e.target===modal) modal.style.display="none";
    if(e.target===overlay) overlay.style.display="none";
  };

  document.querySelectorAll(".view-pill").forEach(pill=>{
    pill.onclick=()=>{
      currentFilter=pill.dataset.filter;
      document.querySelectorAll(".view-pill").forEach(p=>p.classList.remove("active"));
      pill.classList.add("active");
      renderLedger();
    };
  });

  loadLedger();
});

async function loadLedger(){
  const res = await fetch("ledger.json",{cache:"no-store"});
  const data = await res.json();

  allProjects = data.map(e=>({...e, category:getCategory(e)}));
  renderLedger();
}

</script>
